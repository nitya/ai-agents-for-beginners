# 多代理設計模式

當你開始進行涉及多個代理的專案時，就需要考慮多代理設計模式。然而，什麼時候需要切換到多代理模式，以及這樣做的優勢，可能並不馬上明顯。

## 簡介

在本課程中，我們將解答以下問題：

- 多代理模式適用於哪些場景？
- 與單一代理執行多任務相比，使用多代理有哪些優勢？
- 實現多代理設計模式的基礎要素是什麼？
- 如何了解多個代理之間的互動情況？

## 學習目標

完成本課程後，你應該能夠：

- 識別多代理模式適用的場景。
- 理解使用多代理相較於單一代理的優勢。
- 掌握實現多代理設計模式的基礎要素。

### 大局觀

*多代理是一種設計模式，讓多個代理共同合作以達成共同目標*。

這種模式廣泛應用於各種領域，包括機器人技術、自主系統和分散式計算。

## 多代理模式適用的場景

那麼，哪些場景適合使用多代理模式呢？答案是，在許多情況下，採用多代理模式是有益的，尤其是以下幾種情況：

- **大量工作負載**：將龐大的工作負載分解成較小的任務，並分配給不同的代理，可以實現並行處理，加快完成速度。例如，大型數據處理任務就適合這種模式。
- **複雜任務**：與大量工作負載類似，複雜任務也可以被分解成小的子任務，並分配給專注於特定任務的代理。例如，在自動駕駛車輛中，不同的代理可以負責導航、障礙物檢測和與其他車輛的通信。
- **多樣化專業技能**：不同的代理可以擁有不同的專業技能，這使得它們能比單一代理更有效地處理任務的不同方面。例如，在醫療領域，代理可以負責診斷、治療計畫和病人監測。

## 使用多代理相較於單一代理的優勢

單一代理系統在處理簡單任務時可能運作良好，但對於更複雜的任務，使用多代理能提供多項優勢：

- **專業化**：每個代理可以專注於特定任務。如果單一代理缺乏專業化，可能會在面對複雜任務時感到困惑，甚至執行不適合它的任務。
- **可擴展性**：透過增加更多代理來擴展系統，比單一代理承擔過多負載更容易。
- **容錯性**：如果某個代理失效，其他代理仍能繼續運作，確保系統的可靠性。

舉個例子，假設幫用戶預訂旅行。一個單一代理系統需要處理整個預訂流程，包括找航班、訂酒店和租車。這樣的系統可能會變得複雜且難以維護。而多代理系統則可以讓不同的代理專注於找航班、訂酒店和租車，這樣系統更模組化、易於維護且具擴展性。

這可以類比為夫妻檔經營的小型旅行社與連鎖經營的旅行社之間的差異。夫妻檔可能由一個人處理所有旅行預訂細節，而連鎖經營則會讓不同人員專注於不同的預訂任務。

## 實現多代理設計模式的基礎要素

在實現多代理設計模式之前，你需要了解構成這種模式的基礎要素。

以用戶預訂旅行為例，以下是可能的基礎要素：

- **代理通信**：負責找航班、訂酒店和租車的代理需要彼此通信，分享用戶的偏好和限制。例如，找航班的代理需要與訂酒店的代理通信，確保酒店的入住日期與航班日期一致。這意味著你需要決定*哪些代理共享資訊以及如何共享*。
- **協調機制**：代理需要協調行動以滿足用戶的偏好和限制。例如，用戶可能偏好靠近機場的酒店，但租車可能只能在機場取得。這就需要訂酒店的代理與租車的代理協調，以滿足用戶需求。這意味著你需要決定*代理如何協調行動*。
- **代理架構**：代理需要具備內部結構，以便做出決策並從與用戶的互動中學習。例如，找航班的代理需要能決定推薦哪個航班給用戶。這意味著你需要決定*代理如何做決策並從互動中學習*。例如，找航班的代理可以使用機器學習模型，根據用戶過去的偏好來推薦航班。
- **多代理互動的可見性**：需要能夠了解多個代理之間的互動情況。這意味著需要有工具和技術來追蹤代理的活動和互動，可能包括日誌記錄、監控工具、可視化工具以及效能指標。
- **多代理模式**：可以選擇不同的架構模式來實現多代理系統，例如集中式、分散式或混合式架構。需要根據具體需求選擇合適的模式。
- **人機協作**：在多數情況下，人類仍需參與其中，因此需要指導代理何時尋求人類的介入。例如，用戶可能會要求推薦特定的酒店或航班，或在預訂前需要確認。

## 多代理互動的可見性

了解多個代理之間的互動情況至關重要，這對於調試、優化以及確保整體系統的效能都非常必要。為此，需要有工具和技術來追蹤代理的活動和互動。例如：

- **日誌記錄與監控工具**：記錄每個代理的行動。例如，記錄代理採取的行動、行動時間及結果。這些資訊可以用於調試和優化。
- **可視化工具**：使用圖形化方式直觀展示代理之間的互動。例如，可以用一個圖表展示代理之間的資訊流，幫助識別瓶頸或系統中的低效部分。
- **效能指標**：追蹤多代理系統的效能。例如，完成任務所需的時間、每單位時間內完成的任務數量，以及代理推薦的準確性。這些資料有助於找出改進的方向。

## 多代理模式

以下是幾個可用於構建多代理應用的具體模式：

### 群組聊天模式

此模式適用於需要創建多代理群組聊天應用的情況，例如團隊協作、客戶支持和社交網絡。

在這種模式中，每個代理代表群組聊天中的一位用戶，並通過消息協議交換訊息。代理可以向群組發送消息、接收消息並回應其他代理的消息。

該模式可以使用集中式架構（所有消息通過中央伺服器傳遞）或分散式架構（代理之間直接交換消息）來實現。

![群組聊天](../../../translated_images/multi-agent-group-chat.82d537c5c8dc833abbd252033e60874bc9d00df7193888b3377f8426449a0b20.tw.png)

### 任務交接模式

此模式適用於需要創建多代理應用，讓代理之間能夠交接任務的情況。

典型用例包括客戶支持、任務管理和工作流程自動化。

在這種模式中，每個代理代表一個任務或工作流程中的一個步驟，代理可以根據預定規則將任務交接給其他代理。

![任務交接](../../../translated_images/multi-agent-hand-off.ed4f0a5a58614a8a3e962fc476187e630a3ba309d066e460f017b503d0b84cfc.tw.png)

### 協同過濾模式

此模式適用於需要創建多代理應用，讓多個代理合作為用戶提供推薦的情況。

使用多個代理合作的原因在於，每個代理可以具備不同的專業知識，並以不同方式為推薦過程做出貢獻。

例如，用戶希望獲得股市最佳股票的推薦：

- **行業專家**：一個代理可能是特定行業的專家。
- **技術分析**：另一個代理可能專精於技術分析。
- **基本面分析**：還有一個代理可能專精於基本面分析。通過合作，這些代理可以為用戶提供更全面的推薦。

![推薦](../../../translated_images/multi-agent-filtering.719217d169391ddb118bbb726b19d4d89ee139f960f8749ccb2400efb4d0ce79.tw.png)

## 案例：退款流程

考慮一個客戶申請退款的場景，這個過程可能涉及許多代理，我們可以將其分為專屬於退款流程的代理和可以用於其他流程的通用代理。

**退款流程專屬代理**：

以下是一些可能涉及的代理：

- **客戶代理**：代表客戶，負責啟動退款流程。
- **賣家代理**：代表賣家，負責處理退款。
- **支付代理**：代表支付流程，負責將款項退還給客戶。
- **解決代理**：代表問題解決流程，負責處理退款過程中出現的問題。
- **合規代理**：代表合規流程，負責確保退款流程符合規定和政策。

**通用代理**：

這些代理可用於業務中的其他部分：

- **運輸代理**：代表運輸流程，負責將產品寄回賣家。此代理既可用於退款流程，也可用於購買流程中的運輸。
- **回饋代理**：代表回饋流程，負責收集客戶意見。回饋可隨時進行，而不僅限於退款流程。
- **升級代理**：代表升級流程，負責將問題升級至更高級別的支持。此類代理可用於任何需要升級問題的流程。
- **通知代理**：代表通知流程，負責在退款流程的各個階段向客戶發送通知。
- **分析代理**：代表分析流程，負責分析與退款相關的數據。
- **審核代理**：代表審核流程，負責檢查退款流程是否正確執行。
- **報告代理**：代表報告流程，負責生成退款流程的報告。
- **知識代理**：代表知識管理，負責維護與退款流程相關的知識庫。此代理也可以涵蓋其他業務領域。
- **安全代理**：代表安全流程，負責確保退款流程的安全性。
- **質量代理**：代表質量控制，負責確保退款流程的質量。

以上列舉了許多代理，既包括專屬於退款流程的代理，也包括可用於其他業務部分的通用代理。希望這能幫助你了解如何選擇在多代理系統中使用哪些代理。

## 作業

設計一個多代理系統來處理客戶支持流程。識別該流程中涉及的代理、它們的角色和職責，以及它們之間的互動方式。同時考慮專屬於客戶支持流程的代理以及可用於其他業務部分的通用代理。

> 在查看以下解答前，先自己思考一下，你可能需要的代理比想像中更多。

> TIP：考慮客戶支持流程的不同階段，並考慮任何系統可能需要的代理。

## 解答

[解答](./solution/solution.md)

## 知識檢查

問題：什麼時候應該考慮使用多代理？

- [] A1: 當你有少量工作負載和簡單任務時。
- [] A2: 當你有大量工作負載時。
- [] A3: 當你有簡單任務時。

[測驗解答](./solution/solution-quiz.md)

## 總結

在本課程中，我們探討了多代理設計模式，包括多代理適用的場景、使用多代理相較於單一代理的優勢、實現多代理設計模式的基礎要素，以及如何了解多個代理之間的互動情況。

## 其他資源

- [Autogen 設計模式](https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html)
- [Agentic 設計模式](https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/)

**免責聲明**：  
本文件使用機器翻譯服務進行翻譯。我們雖然努力確保準確性，但請注意，自動翻譯可能包含錯誤或不準確之處。原文的母語版本應被視為權威來源。如需關鍵資訊，建議尋求專業人工翻譯。我們對因使用此翻譯而產生的任何誤解或錯誤解釋概不負責。