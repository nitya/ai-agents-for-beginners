# 多代理設計模式

當你開始處理一個涉及多個代理的項目時，你就需要考慮多代理設計模式。然而，何時切換到多代理模式以及其優勢可能並不立刻明顯。

## 簡介

在這一課中，我們將解答以下問題：

- 哪些場景適用於多代理模式？
- 為什麼使用多代理比單一代理處理多個任務更有優勢？
- 實現多代理設計模式的基本構件是什麼？
- 我們如何掌握多個代理之間的互動情況？

## 學習目標

完成這一課後，你應該能夠：

- 辨識適用於多代理的場景。
- 認識使用多代理相較於單一代理的優勢。
- 理解實現多代理設計模式的基本構件。

更大的圖景是什麼？

*多代理是一種設計模式，允許多個代理協作以實現共同目標。*

這種模式被廣泛應用於各個領域，包括機器人學、自主系統和分布式計算。

## 適用於多代理的場景

那麼，哪些場景適合使用多代理呢？答案是，有許多情況使用多代理是有益的，特別是在以下幾種情況：

- **大量工作負載**：龐大的工作負載可以被拆分為更小的任務，分配給不同的代理，從而實現並行處理並加快完成速度。例如，大型數據處理任務。
- **複雜任務**：與大量工作負載類似，複雜任務可以被分解為更小的子任務，並分配給不同的代理，每個代理專注於任務的特定方面。例如，自主車輛中，不同代理負責導航、障礙物檢測和與其他車輛通信。
- **多元專業知識**：不同代理可以擁有不同的專業知識，使其能比單一代理更有效地處理任務的不同方面。例如，在醫療領域，代理可以分別負責診斷、治療計劃和患者監控。

## 使用多代理相較於單一代理的優勢

單一代理系統對於簡單任務可能運行良好，但對於更複雜的任務，使用多代理可以帶來幾個優勢：

- **專業化**：每個代理可以專注於特定任務。單一代理缺乏專業化，可能導致在面對複雜任務時無所適從。例如，它可能執行了一個它並不擅長的任務。
- **可擴展性**：通過添加更多代理而不是讓單一代理承擔過多負載，更容易擴展系統。
- **容錯性**：如果某個代理失效，其他代理仍然可以繼續運行，從而保證系統的可靠性。

舉個例子，假設為用戶預訂旅行。單一代理系統需要處理旅行預訂過程的所有方面，從查找航班到預訂酒店和租車。為了實現這一點，單一代理需要具備處理所有這些任務的工具，這可能導致系統複雜且難以維護與擴展。而多代理系統則可以有不同的代理分別專注於查找航班、預訂酒店和租車，使系統更加模塊化、易於維護且可擴展。

這就像比較一個夫妻經營的小型旅行社與一個連鎖旅行社。夫妻店中，一個人處理所有預訂過程，而連鎖旅行社則由不同的人員分別處理預訂過程的不同部分。

## 實現多代理設計模式的基本構件

在實現多代理設計模式之前，你需要了解構成該模式的基本構件。

讓我們通過再次查看用戶旅行預訂的例子來具體化這些構件。在這種情況下，基本構件包括：

- **代理通信**：負責查找航班、預訂酒店和租車的代理需要進行通信並共享有關用戶偏好和約束的信息。你需要決定通信的協議和方法。具體來說，查找航班的代理需要與預訂酒店的代理通信，確保酒店預訂的日期與航班日期一致。這意味著代理需要共享用戶的旅行日期信息，因此你需要決定*哪些代理共享信息以及如何共享信息*。
- **協作機制**：代理需要協作以確保滿足用戶的偏好和約束。例如，用戶可能偏好靠近機場的酒店，而租車可能只能在機場提供。這意味著預訂酒店的代理需要與租車的代理協作，確保滿足用戶的偏好和約束。因此，你需要決定*代理如何協作行動*。
- **代理架構**：代理需要具備內部結構以做出決策並從與用戶的互動中學習。例如，查找航班的代理需要具備內部結構以決定向用戶推薦哪些航班。因此，你需要決定*代理如何做出決策並從與用戶的互動中學習*。例如，查找航班的代理可以使用機器學習模型，根據用戶過去的偏好推薦航班。
- **多代理互動的可視性**：你需要掌握多個代理如何互動的情況。這意味著你需要有工具和技術來跟蹤代理的活動和互動，例如日誌記錄與監控工具、可視化工具以及性能指標。
- **多代理模式**：有不同的模式可以用來實現多代理系統，比如集中式、分散式和混合式架構。你需要選擇最適合你的用例的模式。
- **人類介入**：在大多數情況下，你需要有人類介入，並需要指導代理何時尋求人類干預。例如，用戶可能要求推薦代理未建議的特定酒店或航班，或者在預訂航班或酒店之前需要確認。

## 多代理互動的可視性

掌握多個代理如何互動非常重要。這種可視性對於調試、優化和確保整體系統的有效性至關重要。為此，你需要有工具和技術來跟蹤代理的活動和互動，例如日誌記錄與監控工具、可視化工具以及性能指標。

例如，在用戶旅行預訂的案例中，你可以有一個儀表板，顯示每個代理的狀態、用戶的偏好和約束，以及代理之間的互動。這個儀表板可以顯示用戶的旅行日期、航班代理推薦的航班、酒店代理推薦的酒店，以及租車代理推薦的租車選項。這可以讓你清楚地了解代理如何互動以及是否滿足用戶的偏好和約束。

讓我們更詳細地看看這些方面：

- **日誌記錄與監控工具**：你需要記錄每個代理採取的行動。例如，一條日誌記錄可以存儲代理採取的行動、行動的時間以及行動的結果。這些信息可以用於調試、優化等。
- **可視化工具**：可視化工具可以幫助你以更直觀的方式看到代理之間的互動。例如，你可以有一個顯示代理之間信息流的圖表。這可以幫助你識別系統中的瓶頸、低效問題等。
- **性能指標**：性能指標可以幫助你跟蹤多代理系統的有效性。例如，你可以跟蹤完成任務所需的時間、每單位時間完成的任務數量，以及代理推薦的準確性。這些信息可以幫助你識別需要改進的地方並優化系統。

## 多代理模式

讓我們深入探討一些可以用來創建多代理應用的具體模式。以下是一些值得考慮的有趣模式：

### 群組聊天

這種模式適用於創建一個多代理可以互相通信的群組聊天應用。典型的用例包括團隊協作、客戶支持和社交網絡。

在這種模式中，每個代理代表群組聊天中的一個用戶，消息通過消息協議在代理之間交換。代理可以向群組聊天發送消息、接收消息並回應其他代理的消息。

這種模式可以通過集中式架構（所有消息通過中央伺服器路由）或分散式架構（消息直接交換）實現。

![群組聊天](../../../translated_images/multi-agent-group-chat.82d537c5c8dc833abbd252033e60874bc9d00df7193888b3377f8426449a0b20.hk.png)

### 任務交接

這種模式適用於創建一個多代理可以將任務交接給彼此的應用。

典型的用例包括客戶支持、任務管理和工作流自動化。

在這種模式中，每個代理代表工作流中的一個任務或步驟，代理可以根據預定規則將任務交接給其他代理。

![任務交接](../../../translated_images/multi-agent-hand-off.ed4f0a5a58614a8a3e962fc476187e630a3ba309d066e460f017b503d0b84cfc.hk.png)

### 協作過濾

這種模式適用於創建一個多代理可以協作向用戶提供建議的應用。

為什麼需要多代理協作？因為每個代理可以擁有不同的專業知識，並以不同的方式為建議過程作出貢獻。

舉例來說，用戶想要獲得股市上最佳股票的建議：

- **行業專家**：一個代理可能是某個特定行業的專家。
- **技術分析**：另一個代理可能是技術分析的專家。
- **基本面分析**：還有一個代理可能是基本面分析的專家。通過協作，這些代理可以為用戶提供更全面的建議。

![建議](../../../translated_images/multi-agent-filtering.719217d169391ddb118bbb726b19d4d89ee139f960f8749ccb2400efb4d0ce79.hk.png)

## 場景：退款流程

考慮一個客戶試圖為產品獲得退款的場景，這個過程可能涉及許多代理，我們可以將其分為退款流程專用代理和可以用於其他流程的通用代理。

**退款流程專用代理**：

以下是一些可能參與退款流程的代理：

- **客戶代理**：代表客戶，負責啟動退款流程。
- **賣家代理**：代表賣家，負責處理退款。
- **支付代理**：代表支付流程，負責將款項退還給客戶。
- **解決代理**：代表解決流程，負責解決退款過程中出現的問題。
- **合規代理**：代表合規流程，負責確保退款流程符合規範和政策。

**通用代理**：

這些代理可以用於業務的其他部分：

- **物流代理**：代表物流流程，負責將產品退回給賣家。該代理可以用於退款流程，也可以用於購買產品的普通物流。
- **反饋代理**：代表反饋流程，負責收集客戶的反饋。反饋可以在任何時間進行，而不僅限於退款流程。
- **升級代理**：代表升級流程，負責將問題升級到更高級別的支持。這類代理可以用於任何需要升級問題的流程。
- **通知代理**：代表通知流程，負責在退款流程的各個階段向客戶發送通知。
- **分析代理**：代表分析流程，負責分析與退款流程相關的數據。
- **審核代理**：代表審核流程，負責審核退款流程以確保其正確執行。
- **報告代理**：代表報告流程，負責生成有關退款流程的報告。
- **知識代理**：代表知識流程，負責維護與退款流程相關的信息知識庫。該代理可以同時了解退款和業務的其他部分。
- **安全代理**：代表安全流程，負責確保退款流程的安全性。
- **質量代理**：代表質量流程，負責確保退款流程的質量。

上述列出了許多代理，包括退款流程專用代理以及可以用於業務其他部分的通用代理。希望這能為你在多代理系統中選擇代理提供一些靈感。

## 作業

這一課的作業是什麼？

為客戶支持流程設計一個多代理系統。識別流程中涉及的代理、它們的角色和責任，以及它們如何互動。考慮既有針對客戶支持流程的專用代理，也有可以用於業務其他部分的通用代理。

> 在閱讀以下解答之前，先自己思考一下，可能需要的代理比你想像的更多。

> TIP: 思考客戶支持流程的不同階段，並考慮任何系統中需要的代理。

## 解答

[解答](./solution/solution.md)

## 知識檢查

問題：什麼時候應該考慮使用多代理？

- [] A1: 當你有一個小工作負載和簡單任務時。
- [] A2: 當你有一個大工作負載時。
- [] A3: 當你有一個簡單任務時。

[測驗解答](./solution/solution-quiz.md)

## 總結

在這一課中，我們探討了多代理設計模式，包括適用於多代理的場景、使用多代理相較於單一代理的優勢、實現多代理設計模式的基本構件，以及如何掌握多個代理之間的互動情況。

## 其他資源

- [Autogen設計模式](https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html)
- [Agentic設計模式](https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/)
```

**免責聲明**：  
本文件使用機器翻譯服務進行翻譯。我們致力於確保準確性，但請注意，自動翻譯可能包含錯誤或不準確之處。應以原文文件作為權威來源。如涉及關鍵資訊，建議尋求專業人工翻譯。我們對因使用此翻譯而引起的任何誤解或誤讀概不負責。